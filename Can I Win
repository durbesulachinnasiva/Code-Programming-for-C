#include <stdbool.h>
#include <string.h>

bool dfs(int usedMask, int currentTotal, int maxChoosableInteger, int desiredTotal, int *memo) {
    if (memo[usedMask] != -1)
        return memo[usedMask];

    for (int i = 1; i <= maxChoosableInteger; i++) {
        int bit = 1 << (i - 1);

        if (usedMask & bit) continue;  // number already taken

        // If choosing i wins immediately OR the opponent cannot win afterward
        if (currentTotal + i >= desiredTotal ||
            !dfs(usedMask | bit, currentTotal + i, maxChoosableInteger, desiredTotal, memo)) {

            memo[usedMask] = 1;
            return true;
        }
    }

    memo[usedMask] = 0;
    return false;
}

bool canIWin(int maxChoosableInteger, int desiredTotal) {
    // If desiredTotal is 0 → first player wins automatically
    if (desiredTotal == 0) return true;

    // If sum of all numbers is less than desiredTotal → cannot reach it
    int maxPossible = (maxChoosableInteger * (maxChoosableInteger + 1)) / 2;
    if (maxPossible < desiredTotal) return false;

    int memoSize = 1 << maxChoosableInteger;
    int *memo = malloc(memoSize * sizeof(int));
    for (int i = 0; i < memoSize; i++)
        memo[i] = -1;

    bool result = dfs(0, 0, maxChoosableInteger, desiredTotal, memo);
    free(memo);

    return result;
}
